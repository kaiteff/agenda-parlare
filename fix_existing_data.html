<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Corregir Datos Existentes</title>
</head>

<body>
    <h1>Corregir Datos Existentes</h1>
    <p>Este script asignará <code>therapist: 'diana'</code> a todos los pacientes y citas que no tengan ese campo.</p>

    <button id="fixBtn"
        style="padding: 20px; font-size: 18px; background: #FF9800; color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 20px;">
        Corregir Datos
    </button>

    <div id="output"
        style="margin-top: 20px; padding: 20px; background: #f5f5f5; border-radius: 5px; font-family: monospace; white-space: pre-wrap; max-height: 500px; overflow-y: auto;">
    </div>

    <script type="module">
        import { fixExistingData } from './js/fix_existing_data.js';

        document.getElementById('fixBtn').addEventListener('click', async () => {
            const output = document.getElementById('output');
            const btn = document.getElementById('fixBtn');

            btn.disabled = true;
            btn.textContent = 'Corrigiendo...';
            output.textContent = 'Iniciando corrección...\n';

            // Capturar console.log
            const originalLog = console.log;
            console.log = (...args) => {
                output.textContent += args.join(' ') + '\n';
                output.scrollTop = output.scrollHeight;
                originalLog(...args);
            };

            try {
                await fixExistingData();
                output.textContent += '\n✅ ¡Corrección completada!';
                output.textContent += '\n\nRecarga la aplicación principal para ver los cambios.';
            } catch (error) {
                output.textContent += '\n❌ Error: ' + error.message;
                console.error(error);
            } finally {
                console.log = originalLog;
                btn.disabled = false;
                btn.textContent = 'Corregir Datos';
            }
        });
    </script>
</body>

</html>